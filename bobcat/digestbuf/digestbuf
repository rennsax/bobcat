#ifndef INCLUDED_BOBCAT_DIGESTBUF_
#define INCLUDED_BOBCAT_DIGESTBUF_

#include <iosfwd>
#include <streambuf>
#include <openssl/evp.h>

namespace FBB
{

class DigestBuf: public std::streambuf
{
    friend std::ostream &operator<<(std::ostream &out, 
                                    DigestBuf const &digestbuf);
    EVP_MD_CTX   *d_ctx;
    EVP_MD const *d_md;
    std::string   d_digest;
    char         *d_buffer;
    size_t        d_bufsize;

    public:
        explicit DigestBuf(char const *type, size_t bufsize = 1024);
        ~DigestBuf() override;

        void open();
        void close();

        std::string const &hash() const;

    private:
        int overflow(int c) override;
};

std::ostream &operator<<(std::ostream &out, DigestBuf const &digestbuf);

}   // FBB
        
#endif



