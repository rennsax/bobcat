#ifndef INCLUDED_BOBCAT_LOGBUFFER_
#define INCLUDED_BOBCAT_LOGBUFFER_

#include <streambuf>
#include <ostream>
#include <string>

namespace FBB
{

enum TimeStamps
{
    NOTIMESTAMPS,
    TIMESTAMPS,
    UTCTIMESTAMPS
};

class LogBuffer: public std::streambuf
{
    std::ostream *d_stream; // the stream to insert info to
    TimeStamps d_timestamps;// what timestamp to use?
    bool d_active;          // actually write information or not
    bool d_empty;           // set to true at the beginning, after writing \n
    std::string d_delim;    // delimiter following time stamps

    public:
        LogBuffer(LogBuffer const &other) = delete;

        explicit LogBuffer(         // output to cerr
                TimeStamps timestamps = TIMESTAMPS,  
                bool active = true,
                char const *delim = " ");
        explicit LogBuffer(std::ostream &stream, 
                TimeStamps timestamps = TIMESTAMPS,
                bool active = true,
                char const *delim = " ");

        LogBuffer &operator=(LogBuffer const &other) = delete;

        void setStream(std::ostream &stream);               // .f
        bool empty() const;                                 // .f

        void setActive(bool active);                        // .f
        void settimestamp(TimeStamps timestamps, char const *delim = " ");

        void setEmpty(bool empty);                          // .f

    private:
        virtual void pSync();       // see the 4.09.00 changelog

        int sync() override;
        int overflow(int c) override;
        std::streamsize xsputn(char const *buffer, std::streamsize n) 
                                                                override;

        size_t newLine(char const *buffer, size_t begin, size_t n) const;
        void checkTimestamp();
        void insertTimestamp();
};

#include "empty.f"
#include "setactive.f"
#include "setempty.f"
#include "setstream.f"

} // FBB
        
#endif
